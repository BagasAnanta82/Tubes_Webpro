var J=Object.defineProperty;var q=(m,i,s)=>i in m?J(m,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):m[i]=s;var C=(m,i,s)=>(q(m,typeof i!="symbol"?i+"":i,s),s);import{d as H,h as Q,r as u,i as W,o as X,j as Z,w as ee,a as c,b as T,c as V,e as n,f as a,k as d,l as v,t as y,m as M,F as te}from"./index-02138ba0.js";import{A as ae}from"./AttendencePermitTypeService-381a7af9.js";class ne{constructor(){C(this,"url");C(this,"token");this.url="https://api-sman24.matradipti.org/api/v1/",this.token=JSON.parse(window.localStorage.getItem("token")).token}getStudentAttandencePermitRecords(i=new Date().toISOString()){return fetch(`${this.url}attandencepermit?date_at=${i}`,{method:"GET",headers:{Authorization:`Bearer ${this.token}`}}).then(s=>s.json()).then(s=>s.data)}updateStudentAttandencePermitRecords(i){return fetch(`${this.url}attandencepermit`,{method:"PUT",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:`Bearer ${this.token}`},body:JSON.stringify({attandence_permit_id:i.id,attandence_permit_type_id:i.permit_type_id.id,description:i.description})}).then(s=>s.json()).then(s=>s)}deleteStudentAttandencePermitRecord(i){return fetch(`${this.url}attandencepermit`,{method:"DELETE",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:`Bearer ${this.token}`},body:JSON.stringify({attandence_permit_id:i.id})}).then(s=>s.json()).then(s=>s)}deleteMutltipleStudentAttandencePermitRecord(i){return fetch(`${this.url}attandencepermit/multiple`,{method:"DELETE",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:`Bearer ${this.token}`},body:JSON.stringify({json:i})}).then(s=>s.json()).then(s=>s)}}const ie={class:"card"},se=n("h3",null,"Silahkan Pilih Tanggal",-1),le={class:"grid"},oe={class:"col-12"},de={class:"card"},re={class:"my-2"},ue={class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center"},ce=n("h5",{class:"m-0"},"Pencapaian SMAN 24",-1),pe={class:"block mt-2 md:mt-0 p-input-icon-left"},me=n("i",{class:"pi pi-search"},null,-1),he=n("span",{class:"p-column-title"},"Name",-1),ve=n("span",{class:"p-column-title"},"NIS",-1),_e=n("span",{class:"p-column-title"},"Kelas",-1),ge=n("span",{class:"p-column-title"},"code",-1),fe=n("span",{class:"p-column-title"},"Presensi",-1),ye={class:"field"},be=n("label",{for:"name"},"Nama Siswa",-1),Se={class:"field"},we=n("label",{for:"inventoryStatus",class:"mb-3"},"Status Presensi",-1),Pe={class:"field"},ke=n("label",{for:"description"},"Keterangan",-1),De={class:"flex align-items-center justify-content-center"},xe=n("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}},null,-1),Ae={key:0},Ce={class:"flex align-items-center justify-content-center"},Te=n("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}},null,-1),Ve={key:0},Re=H({__name:"AttendencePermit",setup(m){const i=Q(),s=u(null),_=u(null),g=u(null),o=u({}),f=u(new Date),D=u(null),k=u({}),b=u(!1),S=u(!1),w=u(!1),p=new ne,B=new ae;W(()=>{L()}),X(()=>{p.getStudentAttandencePermitRecords().then(l=>_.value=l),B.getAttendencePermitTypeService().then(l=>D.value=l)});const R=()=>{o.value={},b.value=!1},j=l=>{o.value={...l},o.value.permit_type_id=D.value.filter(e=>e.id==o.value.permit_type_id)[0],b.value=!0},$=async()=>{const l=new Date(f.value);l.setDate(l.getDate()+1),await p.updateStudentAttandencePermitRecords(o.value).then(e=>e.status?i.add({severity:"success",summary:"Berhasil",detail:"Berhasil Memperbaharui Presensi Siswa",life:3e3}):i.add({severity:"error",summary:"Gagal",detail:"Gagal Memperbaharui Presensi Siswa",life:3e3})),await p.getStudentAttandencePermitRecords(l.toISOString()).then(e=>_.value=e),o.value={},b.value=!1},I=l=>{o.value={...l},S.value=!0},U=async()=>{const l=new Date(f.value);l.setDate(l.getDate()+1),await p.deleteStudentAttandencePermitRecord(o.value).then(e=>e.status?i.add({severity:"success",summary:"Berhasil",detail:"Berhasil Menghapus Presensi Siswa",life:3e3}):i.add({severity:"error",summary:"Gagal",detail:"Gagal Menghapus Presensi Siswa",life:3e3})),await p.getStudentAttandencePermitRecords(l.toISOString()).then(e=>_.value=e),o.value={},S.value=!1},O=async()=>{const l=new Date(f.value);l.setDate(l.getDate()+1),await p.deleteMutltipleStudentAttandencePermitRecord(g.value).then(e=>e.status?i.add({severity:"success",summary:"Berhasil",detail:"Berhasil Menghapus Presensi Siswa",life:3e3}):i.add({severity:"error",summary:"Gagal",detail:"Gagal Menghapus Presensi Siswa",life:3e3})),await p.getStudentAttandencePermitRecords(l.toISOString()).then(e=>_.value=e),g.value=null,w.value=!1},E=()=>{s.value.exportCSV()},L=()=>{k.value={global:{value:null,matchMode:Z.CONTAINS}}};return ee(f,async(l,e)=>{const P=new Date(l);P.setDate(P.getDate()+1),p.getStudentAttandencePermitRecords(P.toISOString()).then(x=>_.value=x)}),(l,e)=>{const P=c("Calendar"),x=c("Toast"),r=c("Button"),z=c("Toolbar"),N=c("InputText"),h=c("Column"),G=c("DataTable"),K=c("Dropdown"),F=c("Textarea"),A=c("Dialog");return T(),V(te,null,[n("div",ie,[se,a(P,{modelValue:f.value,"onUpdate:modelValue":e[0]||(e[0]=t=>f.value=t),style:{width:"70%"}},null,8,["modelValue"])]),n("div",le,[n("div",oe,[n("div",de,[a(x),a(z,{class:"mb-4"},{start:d(()=>[n("div",re,[a(r,{label:"Delete",icon:"pi pi-trash",class:"p-button-danger",onClick:e[1]||(e[1]=t=>w.value=!0),disabled:!g.value||!g.value.length},null,8,["disabled"])])]),end:d(()=>[a(r,{label:"Export",icon:"pi pi-upload",class:"p-button-help",onClick:e[2]||(e[2]=t=>E(t))})]),_:1}),a(G,{ref_key:"dt",ref:s,value:_.value,selection:g.value,"onUpdate:selection":e[4]||(e[4]=t=>g.value=t),dataKey:"id",paginator:!0,rows:20,filters:k.value,paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",rowsPerPageOptions:[20,50,100],currentPageReportTemplate:"Showing {first} to {last} of {totalRecords} products",responsiveLayout:"scroll"},{header:d(()=>[n("div",ue,[ce,n("span",pe,[me,a(N,{modelValue:k.value.global.value,"onUpdate:modelValue":e[3]||(e[3]=t=>k.value.global.value=t),placeholder:"Search..."},null,8,["modelValue"])])])]),default:d(()=>[a(h,{selectionMode:"multiple",headerStyle:"width: 3rem"}),a(h,{field:"student_name",header:"Name",sortable:!0,headerStyle:"width:14%; min-width:10rem;"},{body:d(t=>[he,v(" "+y(t.data.student_name),1)]),_:1}),a(h,{field:"NIS",header:"NIS",sortable:!0,headerStyle:"width:14%; min-width:10rem;"},{body:d(t=>[ve,v(" "+y(t.data.NIS),1)]),_:1}),a(h,{field:"classroom_name",header:"Kelas",sortable:!0,headerStyle:"width:14%; min-width:10rem;"},{body:d(t=>[_e,v(" "+y(t.data.classroom_name),1)]),_:1}),a(h,{field:"code",header:"Kelamin",sortable:!0,headerStyle:"width:14%; min-width:10rem;"},{body:d(t=>[ge,v(" "+y(t.data.code),1)]),_:1}),a(h,{field:"permit_type_name",header:"Status Presensi",sortable:!0,headerStyle:"width:14%; min-width:10rem;"},{body:d(t=>[fe,v(" "+y(t.data.permit_type_name),1)]),_:1}),a(h,{headerStyle:"min-width:10rem;"},{body:d(t=>[a(r,{icon:"pi pi-pencil",class:"p-button-rounded p-button-success mr-2",onClick:Y=>j(t.data)},null,8,["onClick"]),a(r,{icon:"pi pi-trash",class:"p-button-rounded p-button-warning mt-2",onClick:Y=>I(t.data)},null,8,["onClick"])]),_:1})]),_:1},8,["value","selection","filters"]),a(A,{visible:b.value,"onUpdate:visible":e[8]||(e[8]=t=>b.value=t),maximizable:"",breakpoints:{"1199px":"75vw","575px":"90vw"},style:{width:"650px"},header:"Edit Data Pencapaian",modal:!0,class:"p-fluid"},{footer:d(()=>[a(r,{label:"Cancel",icon:"pi pi-times",class:"p-button-text",onClick:R}),a(r,{label:"Save",icon:"pi pi-check",class:"p-button-text",onClick:$})]),default:d(()=>[n("div",ye,[be,a(N,{id:"name",disabled:"",modelValue:o.value.student_name,"onUpdate:modelValue":e[5]||(e[5]=t=>o.value.student_name=t),modelModifiers:{trim:!0},required:"true"},null,8,["modelValue"])]),n("div",Se,[we,a(K,{id:"inventoryStatus",modelValue:o.value.permit_type_id,"onUpdate:modelValue":e[6]||(e[6]=t=>o.value.permit_type_id=t),options:D.value,optionLabel:"name"},null,8,["modelValue","options"])]),n("div",Pe,[ke,a(F,{id:"description",placeholder:"Dapat Berupa Keteranga Atau dengan link pendukung",modelValue:o.value.description,"onUpdate:modelValue":e[7]||(e[7]=t=>o.value.description=t),rows:"5",cols:"30"},null,8,["modelValue"])])]),_:1},8,["visible"]),a(A,{visible:S.value,"onUpdate:visible":e[10]||(e[10]=t=>S.value=t),style:{width:"450px"},header:"Confirm",modal:!0},{footer:d(()=>[a(r,{label:"No",icon:"pi pi-times",class:"p-button-text",onClick:e[9]||(e[9]=t=>S.value=!1)}),a(r,{label:"Yes",icon:"pi pi-check",class:"p-button-text",onClick:U})]),default:d(()=>[n("div",De,[xe,o.value?(T(),V("span",Ae,[v("Apakah Anda Yakin Untuk Menghapus Data "),n("b",null,y(o.value.student_name),1),v("?")])):M("",!0)])]),_:1},8,["visible"]),a(A,{visible:w.value,"onUpdate:visible":e[12]||(e[12]=t=>w.value=t),style:{width:"450px"},header:"Confirm",modal:!0},{footer:d(()=>[a(r,{label:"No",icon:"pi pi-times",class:"p-button-text",onClick:e[11]||(e[11]=t=>w.value=!1)}),a(r,{label:"Yes",icon:"pi pi-check",class:"p-button-text",onClick:O})]),default:d(()=>[n("div",Ce,[Te,o.value?(T(),V("span",Ve,"Apakah Anda Yakin Untuk Menghapus Data Yang Dipilih?")):M("",!0)])]),_:1},8,["visible"])])])])],64)}}});export{Re as default};
