var O=Object.defineProperty;var P=(m,t,a)=>t in m?O(m,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):m[t]=a;var N=(m,t,a)=>(P(m,typeof t!="symbol"?t+"":t,a),a);import{d as $,r as p,i as R,o as M,j as w,q as x,w as A,a as v,b as T,c as D,e as s,f as l,k as n,l as _,t as V,F as K}from"./index-1becf62d.js";import{C as j}from"./ClassroomService-4484b5fa.js";class H{constructor(){N(this,"url");N(this,"token");this.url="https://api-sman24dev.matradipti.org/api/v1/",this.token=JSON.parse(window.localStorage.getItem("token")).token}getStudentAttendences(t=new Date().toISOString(),a=null){return fetch(`${this.url}attandence/records?date_at=${t}&classroom_id=${a}`,{method:"GET",headers:{Authorization:`Bearer ${this.token}`}}).then(u=>u.json()).then(u=>u.data)}async getStudentAttendencesExcelExport(){const t=await fetch(`${this.url}excel/attandence`,{method:"GET",headers:{Authorization:`Bearer ${this.token}`}}).then(d=>d.arrayBuffer()).then(d=>d),a=new File([t],"filename.xlsx",{type:"application/vnd.ms-excel"}),u=URL.createObjectURL(a);window.open(u)}}const L={class:"card"},W=s("h1",null,"Rekam Presensi SMAN24 Bandung",-1),z={class:"grid mt-4"},G={class:"col-12 lg:col-6"},q=s("h5",null,"Silahkan Pilih Tanggal Presensi",-1),J={class:"col-12 lg:col-6"},Q=s("h5",null,"Kelas",-1),X={className:"card"},Y={class:"flex justify-content-between flex-column sm:flex-row"},Z={class:"text-align-left gap-2"},ee={class:"p-input-icon-left mb-2"},te=s("i",{class:"pi pi-search"},null,-1),le={key:0},ae={key:1},de=$({__name:"Attendance",setup(m){const t=p(null),a=p(null),u=p(null),d=p(null),I=p(!0),f=p(new Date),C=p(null),g=new H,U=new j;R(()=>{I.value=!1,k()}),M(()=>{g.getStudentAttendences().then(c=>t.value=c),U.getAllClassroom().then(c=>u.value=c)});const k=()=>{d.value={global:{value:null,matchMode:w.CONTAINS},name:{operator:x.AND,constraints:[{value:null,matchMode:w.STARTS_WITH}]},NIS:{operator:x.AND,constraints:[{value:null,matchMode:w.STARTS_WITH}]},NISN:{operator:x.AND,constraints:[{value:null,matchMode:w.STARTS_WITH}]}}},B=()=>{k()},F=async()=>{await g.getStudentAttendencesExcelExport()};return A(f,async(c,o)=>{const i=new Date(c),S=a.value==null?null:a.value.id;i.setDate(i.getDate()+1),await g.getStudentAttendences(i.toISOString(),S).then(b=>t.value=b)}),A(a,async(c,o)=>{const i=new Date(f.value);i.setDate(i.getDate()+1),await g.getStudentAttendences(i.toISOString(),c.id).then(S=>t.value=S)}),(c,o)=>{const i=v("Calendar"),S=v("Dropdown"),b=v("Button"),h=v("InputText"),y=v("Column"),E=v("DataTable");return T(),D(K,null,[s("div",L,[W,s("div",z,[s("div",G,[q,l(i,{id:"date",modelValue:f.value,"onUpdate:modelValue":o[0]||(o[0]=e=>f.value=e),style:{width:"70%"}},null,8,["modelValue"])]),s("div",J,[Q,l(S,{modelValue:a.value,"onUpdate:modelValue":o[1]||(o[1]=e=>a.value=e),options:u.value,optionLabel:"name",placeholder:"Silah Pilih Kelas"},null,8,["modelValue","options"])])])]),s("div",X,[l(E,{ref_key:"dt",ref:C,value:t.value,paginator:!0,class:"p-datatable-gridlines",rows:20,dataKey:"id",rowHover:!0,rowsPerPageOptions:[20,50,75,100],filters:d.value,"onUpdate:filters":o[5]||(o[5]=e=>d.value=e),filterDisplay:"menu",loading:I.value,responsiveLayout:"scroll",globalFilterFields:["name","NIS","NISN"]},{header:n(()=>[s("div",Y,[s("div",Z,[l(b,{type:"button",icon:"pi pi-filter-slash",label:"Clear",class:"p-button-outlined mb-2",onClick:o[2]||(o[2]=e=>B())}),l(b,{type:"button",icon:"pi pi-upload",label:"Export",class:"p-button-outlined mb-2",onClick:o[3]||(o[3]=e=>F())})]),s("span",ee,[te,l(h,{modelValue:d.value.global.value,"onUpdate:modelValue":o[4]||(o[4]=e=>d.value.global.value=e),placeholder:"Keyword Search",style:{width:"100%"}},null,8,["modelValue"])])])]),empty:n(()=>[_(" Data Tidak Ditemukan. ")]),loading:n(()=>[_(" Memuat Data Presensi, Mohon Tunggu. ")]),default:n(()=>[l(y,{field:"name",header:"Name",style:{"min-width":"12rem"}},{body:n(({data:e})=>[_(V(e.name),1)]),filter:n(({filterModel:e})=>[l(h,{type:"text",modelValue:e.value,"onUpdate:modelValue":r=>e.value=r,class:"p-column-filter",placeholder:"Search by name"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),l(y,{field:"NISN",header:"NISN",style:{"min-width":"12rem"}},{body:n(({data:e})=>[_(V(e.NISN),1)]),filter:n(({filterModel:e})=>[l(h,{type:"text",modelValue:e.value,"onUpdate:modelValue":r=>e.value=r,class:"p-column-filter",placeholder:"Search by NISN"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),l(y,{field:"gender",header:"Kelamin",style:{"min-width":"12rem"}},{body:n(({data:e})=>[_(V(e.code),1)]),filter:n(({filterModel:e})=>[l(h,{type:"text",modelValue:e.value,"onUpdate:modelValue":r=>e.value=r,class:"p-column-filter",placeholder:"Search by NISN"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),l(y,{field:"timestamp",header:"timestamp",style:{"min-width":"12rem"}},{body:n(({data:e})=>[_(V(e.timestamp),1)]),filter:n(({filterModel:e})=>[l(h,{type:"text",modelValue:e.value,"onUpdate:modelValue":r=>e.value=r,class:"p-column-filter",placeholder:"Search by NISN"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),l(y,{field:"is_late",header:"Status",style:{"min-width":"12rem"}},{body:n(({data:e})=>[e.is_late==!0?(T(),D("div",le," Terlambat ")):(T(),D("div",ae," Tepat Waktu "))]),filter:n(({filterModel:e})=>[l(h,{type:"text",modelValue:e.value,"onUpdate:modelValue":r=>e.value=r,class:"p-column-filter",placeholder:"Search by NISN"},null,8,["modelValue","onUpdate:modelValue"])]),_:1})]),_:1},8,["value","filters","loading"])])],64)}}});export{de as default};
