var J=Object.defineProperty;var K=(p,l,n)=>l in p?J(p,l,{enumerable:!0,configurable:!0,writable:!0,value:n}):p[l]=n;var T=(p,l,n)=>(K(p,typeof l!="symbol"?l+"":l,n),n);import{d as q,h as H,r as u,i as Q,o as W,j as X,w as Z,a as c,b as x,c as N,e as i,f as a,k as r,l as v,t as y,n as ee,m as M,F as te}from"./index-319c10fa.js";import{A as ae}from"./AttendencePermitTypeService-e171d858.js";class ne{constructor(){T(this,"url");T(this,"token");this.url="https://api-sman24dev.matradipti.org/api/v1/",this.token=JSON.parse(window.localStorage.getItem("token")).token}getStudentAttandencePermitRecords(l=new Date().toISOString()){return fetch(`${this.url}attandencepermit?date_at=${l}`,{method:"GET",headers:{Authorization:`Bearer ${this.token}`}}).then(n=>n.json()).then(n=>n.data)}updateStudentAttandencePermitRecords(l){return fetch(`${this.url}attandencepermit`,{method:"PUT",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:`Bearer ${this.token}`},body:JSON.stringify({attandence_permit_id:l.id,attandence_permit_type_id:l.permit_type_id.id})}).then(n=>n.json()).then(n=>n)}deleteStudentAttandencePermitRecord(l){return fetch(`${this.url}attandencepermit`,{method:"DELETE",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:`Bearer ${this.token}`},body:JSON.stringify({attandence_permit_id:l.id})}).then(n=>n.json()).then(n=>n)}deleteMutltipleStudentAttandencePermitRecord(l){return fetch(`${this.url}attandencepermit/multiple`,{method:"DELETE",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:`Bearer ${this.token}`},body:JSON.stringify({json:l})}).then(n=>n.json()).then(n=>n)}}const se={class:"card"},ie=i("h3",null,"Silahkan Pilih Tanggal",-1),le={class:"grid"},oe={class:"col-12"},re={class:"card"},de={class:"my-2"},ue={class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center"},ce=i("h5",{class:"m-0"},"Pencapaian SMAN 24",-1),me={class:"block mt-2 md:mt-0 p-input-icon-left"},pe=i("i",{class:"pi pi-search"},null,-1),he=i("span",{class:"p-column-title"},"Name",-1),ve=i("span",{class:"p-column-title"},"NIS",-1),_e=i("span",{class:"p-column-title"},"Kelas",-1),fe=i("span",{class:"p-column-title"},"code",-1),ge=i("span",{class:"p-column-title"},"Presensi",-1),ye={class:"field"},be=i("label",{for:"name"},"Nama Siswa",-1),Se={class:"field"},we=i("label",{for:"inventoryStatus",class:"mb-3"},"Status Presensi",-1),Pe={class:"flex align-items-center justify-content-center"},ke=i("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}},null,-1),De={key:0},Ce={class:"flex align-items-center justify-content-center"},Ae=i("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}},null,-1),Te={key:0},Me=q({__name:"AttendencePermit",setup(p){const l=H(),n=u(null),_=u(null),f=u(null),o=u({}),g=u(new Date),D=u(null),k=u({}),b=u(!1),S=u(!1),w=u(!1),m=new ne,B=new ae;Q(()=>{L()}),W(()=>{m.getStudentAttandencePermitRecords().then(s=>_.value=s),B.getAttendencePermitTypeService().then(s=>D.value=s)});const R=()=>{o.value={},b.value=!1},j=s=>{o.value={...s},o.value.permit_type_id=D.value.filter(e=>e.id==o.value.permit_type_id)[0],b.value=!0},$=async()=>{const s=new Date(g.value);s.setDate(s.getDate()+1),await m.updateStudentAttandencePermitRecords(o.value).then(e=>e.status?l.add({severity:"success",summary:"Berhasil",detail:"Berhasil Memperbaharui Presensi Siswa",life:3e3}):l.add({severity:"error",summary:"Gagal",detail:"Gagal Memperbaharui Presensi Siswa",life:3e3})),await m.getStudentAttandencePermitRecords(s.toISOString()).then(e=>_.value=e),o.value={},b.value=!1},I=s=>{o.value={...s},S.value=!0},O=async()=>{const s=new Date(g.value);s.setDate(s.getDate()+1),await m.deleteStudentAttandencePermitRecord(o.value).then(e=>e.status?l.add({severity:"success",summary:"Berhasil",detail:"Berhasil Menghapus Presensi Siswa",life:3e3}):l.add({severity:"error",summary:"Gagal",detail:"Gagal Menghapus Presensi Siswa",life:3e3})),await m.getStudentAttandencePermitRecords(s.toISOString()).then(e=>_.value=e),o.value={},S.value=!1},U=async()=>{const s=new Date(g.value);s.setDate(s.getDate()+1),await m.deleteMutltipleStudentAttandencePermitRecord(f.value).then(e=>e.status?l.add({severity:"success",summary:"Berhasil",detail:"Berhasil Menghapus Presensi Siswa",life:3e3}):l.add({severity:"error",summary:"Gagal",detail:"Gagal Menghapus Presensi Siswa",life:3e3})),await m.getStudentAttandencePermitRecords(s.toISOString()).then(e=>_.value=e),f.value=null,w.value=!1},E=()=>{n.value.exportCSV()},L=()=>{k.value={global:{value:null,matchMode:X.CONTAINS}}};return Z(g,async(s,e)=>{const P=new Date(s);P.setDate(P.getDate()+1),m.getStudentAttandencePermitRecords(P.toISOString()).then(C=>_.value=C)}),(s,e)=>{const P=c("Calendar"),C=c("Toast"),d=c("Button"),z=c("Toolbar"),V=c("InputText"),h=c("Column"),G=c("DataTable"),F=c("Dropdown"),A=c("Dialog");return x(),N(te,null,[i("div",se,[ie,a(P,{modelValue:g.value,"onUpdate:modelValue":e[0]||(e[0]=t=>g.value=t),style:{width:"70%"}},null,8,["modelValue"])]),i("div",le,[i("div",oe,[i("div",re,[a(C),a(z,{class:"mb-4"},{start:r(()=>[i("div",de,[a(d,{label:"Delete",icon:"pi pi-trash",class:"p-button-danger",onClick:e[1]||(e[1]=t=>w.value=!0),disabled:!f.value||!f.value.length},null,8,["disabled"])])]),end:r(()=>[a(d,{label:"Export",icon:"pi pi-upload",class:"p-button-help",onClick:e[2]||(e[2]=t=>E(t))})]),_:1}),a(G,{ref_key:"dt",ref:n,value:_.value,selection:f.value,"onUpdate:selection":e[4]||(e[4]=t=>f.value=t),dataKey:"id",paginator:!0,rows:10,filters:k.value,paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",rowsPerPageOptions:[10,20,25],currentPageReportTemplate:"Showing {first} to {last} of {totalRecords} products",responsiveLayout:"scroll"},{header:r(()=>[i("div",ue,[ce,i("span",me,[pe,a(V,{modelValue:k.value.global.value,"onUpdate:modelValue":e[3]||(e[3]=t=>k.value.global.value=t),placeholder:"Search..."},null,8,["modelValue"])])])]),default:r(()=>[a(h,{selectionMode:"multiple",headerStyle:"width: 3rem"}),a(h,{field:"name",header:"Name",sortable:!0,headerStyle:"width:14%; min-width:10rem;"},{body:r(t=>[he,v(" "+y(t.data.student_name),1)]),_:1}),a(h,{field:"NIS",header:"NIS",sortable:!0,headerStyle:"width:14%; min-width:10rem;"},{body:r(t=>[ve,v(" "+y(t.data.NIS),1)]),_:1}),a(h,{field:"classroom_name",header:"Kelas",sortable:!0,headerStyle:"width:14%; min-width:10rem;"},{body:r(t=>[_e,v(" "+y(t.data.classroom_name),1)]),_:1}),a(h,{field:"code",header:"Kelamin",sortable:!0,headerStyle:"width:14%; min-width:10rem;"},{body:r(t=>[fe,v(" "+y(t.data.code),1)]),_:1}),a(h,{field:"permit_type_name",header:"Status Presensi",sortable:!0,headerStyle:"width:14%; min-width:10rem;"},{body:r(t=>[ge,v(" "+y(t.data.permit_type_name),1)]),_:1}),a(h,{headerStyle:"min-width:10rem;"},{body:r(t=>[a(d,{icon:"pi pi-pencil",class:"p-button-rounded p-button-success mr-2",onClick:Y=>j(t.data)},null,8,["onClick"]),a(d,{icon:"pi pi-trash",class:"p-button-rounded p-button-warning mt-2",onClick:Y=>I(t.data)},null,8,["onClick"])]),_:1})]),_:1},8,["value","selection","filters"]),a(A,{visible:b.value,"onUpdate:visible":e[7]||(e[7]=t=>b.value=t),style:{width:"450px"},header:"Edit Data Pencapaian",modal:!0,class:"p-fluid"},{footer:r(()=>[a(d,{label:"Cancel",icon:"pi pi-times",class:"p-button-text",onClick:R}),a(d,{label:"Save",icon:"pi pi-check",class:"p-button-text",onClick:$})]),default:r(()=>[i("div",ye,[be,a(V,{id:"name",disabled:"",modelValue:o.value.student_name,"onUpdate:modelValue":e[5]||(e[5]=t=>o.value.student_name=t),modelModifiers:{trim:!0},required:"true",autofocus:"",class:ee({"p-invalid":s.submitted&&!s.product.name})},null,8,["modelValue","class"])]),i("div",Se,[we,a(F,{id:"inventoryStatus",modelValue:o.value.permit_type_id,"onUpdate:modelValue":e[6]||(e[6]=t=>o.value.permit_type_id=t),options:D.value,optionLabel:"name"},null,8,["modelValue","options"])])]),_:1},8,["visible"]),a(A,{visible:S.value,"onUpdate:visible":e[9]||(e[9]=t=>S.value=t),style:{width:"450px"},header:"Confirm",modal:!0},{footer:r(()=>[a(d,{label:"No",icon:"pi pi-times",class:"p-button-text",onClick:e[8]||(e[8]=t=>S.value=!1)}),a(d,{label:"Yes",icon:"pi pi-check",class:"p-button-text",onClick:O})]),default:r(()=>[i("div",Pe,[ke,o.value?(x(),N("span",De,[v("Apakah Anda Yakin Untuk Menghapus Data "),i("b",null,y(o.value.student_name),1),v("?")])):M("",!0)])]),_:1},8,["visible"]),a(A,{visible:w.value,"onUpdate:visible":e[11]||(e[11]=t=>w.value=t),style:{width:"450px"},header:"Confirm",modal:!0},{footer:r(()=>[a(d,{label:"No",icon:"pi pi-times",class:"p-button-text",onClick:e[10]||(e[10]=t=>w.value=!1)}),a(d,{label:"Yes",icon:"pi pi-check",class:"p-button-text",onClick:U})]),default:r(()=>[i("div",Ce,[Ae,o.value?(x(),N("span",Te,"Apakah Anda Yakin Untuk Menghapus Data Yang Dipilih?")):M("",!0)])]),_:1},8,["visible"])])])])],64)}}});export{Me as default};
