var R=Object.defineProperty;var K=(h,o,l)=>o in h?R(h,o,{enumerable:!0,configurable:!0,writable:!0,value:l}):h[o]=l;var x=(h,o,l)=>(K(h,typeof o!="symbol"?o+"":o,l),l);import{d as H,h as L,r as c,i as W,o as z,j as D,q as A,w as O,a as m,b as I,c as C,f as a,e as n,k as s,l as p,t as N,F as J}from"./index-0630a3cf.js";import{C as Y}from"./ClassroomService-4484b5fa.js";class q{constructor(){x(this,"url");x(this,"token");this.url="https://api-sman24dev.matradipti.org/api/v1/",this.token=JSON.parse(window.localStorage.getItem("token")).token}getStudentAttendences(o=new Date().toISOString(),l=null){return fetch(`${this.url}attandence/records?date_at=${o}&classroom_id=${l}`,{method:"GET",headers:{Authorization:`Bearer ${this.token}`}}).then(d=>d.json()).then(d=>d.data)}async getStudentAttendencesExcelExport(){const o=await fetch(`${this.url}excel/attandence`,{method:"GET",headers:{Authorization:`Bearer ${this.token}`}}).then(g=>g.arrayBuffer()).then(g=>g),l=new File([o],"filename.xlsx",{type:"application/vnd.ms-excel"}),d=URL.createObjectURL(l);window.open(d)}generateStudentDidNotTapping(o=new Date().toISOString()){return fetch(`${this.url}attandence/generate`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:`Bearer ${this.token}`},body:JSON.stringify({date_at:o})}).then(l=>l.json()).then(l=>l)}}const Q={class:"card"},X=n("h1",null,"Rekam Presensi SMAN24 Bandung",-1),Z={class:"grid mt-4"},ee={class:"col-12 lg:col-6"},te=n("h5",null,"Silahkan Pilih Tanggal Presensi Dan Generate",-1),ae={class:"col-12 lg:col-6"},le=n("h5",null,"Kelas",-1),ne=n("h3",null,"Generasi Siswa Yang Tidak Absen",-1),oe={className:"card"},se={class:"flex justify-content-between flex-column sm:flex-row"},ie={class:"text-align-left gap-2"},de={class:"p-input-icon-left mb-2"},re=n("i",{class:"pi pi-search"},null,-1),ue={key:0},ce={key:1},pe=n("h3",null,"Apakah Anda Yakin?",-1),me=n("p",null,[p("Untuk melakukan peng-generate data akan membutuhkan waktu yang tidak sebentar (akan sangat bergantung terpada banyak data yang dibutuhakn). Diharapkan untuk tidak menutup "),n("b",null,"Browser dan Tab pada Browser"),p(" Ketika Proses sedang berlangsung. Serta pastikan bahwa "),n("i",null,"internet connection"),p(" anda pada keadaan yang stabil ")],-1),he={class:"flex justify-content-end gap-2"},Se=H({__name:"Attendance",setup(h){const o=L(),l=c(null),d=c(null),g=c(null),y=c(null),U=c(!0),S=c(new Date),$=c(null),b=c(!1),T=c(!1),_=new q,G=new Y;W(()=>{U.value=!1,B()}),z(()=>{_.getStudentAttendences().then(i=>l.value=i),G.getAllClassroom().then(i=>g.value=i)});const B=()=>{y.value={global:{value:null,matchMode:D.CONTAINS},name:{operator:A.AND,constraints:[{value:null,matchMode:D.STARTS_WITH}]},NIS:{operator:A.AND,constraints:[{value:null,matchMode:D.STARTS_WITH}]},NISN:{operator:A.AND,constraints:[{value:null,matchMode:D.STARTS_WITH}]}}},P=async()=>{const i=new Date(S.value);i.setDate(i.getDate()+1),T.value=!0,o.add({severity:"info",summary:"Sedang melakukan generasi data",detail:"Harap Untuk Tidak Menutup Browser atau Tab pada proses sedang berlangsung",life:5e3}),await _.generateStudentDidNotTapping(i.toISOString()).then(t=>t.status?o.add({severity:"success",summary:"Berhasil",detail:"Data Berhasil Digenerate",life:3e3}):o.add({severity:"error",summary:"Gagal",detail:"Gagal Untuk Melakuakan Generasi data",life:3e3})),b.value=!1,T.value=!1},F=()=>{B()},j=async()=>{await _.getStudentAttendencesExcelExport()};return O(S,async(i,t)=>{const r=new Date(i),f=d.value==null?null:d.value.id;r.setDate(r.getDate()+1),await _.getStudentAttendences(r.toISOString(),f).then(V=>l.value=V)}),O(d,async(i,t)=>{const r=new Date(S.value);r.setDate(r.getDate()+1),await _.getStudentAttendences(r.toISOString(),i.id).then(f=>l.value=f)}),(i,t)=>{const r=m("Toast"),f=m("Calendar"),V=m("Dropdown"),k=m("Button"),v=m("InputText"),w=m("Column"),E=m("DataTable"),M=m("Dialog");return I(),C(J,null,[a(r),n("div",Q,[X,n("div",Z,[n("div",ee,[te,a(f,{id:"date",modelValue:S.value,"onUpdate:modelValue":t[0]||(t[0]=e=>S.value=e),style:{width:"70%"}},null,8,["modelValue"])]),n("div",ae,[le,a(V,{modelValue:d.value,"onUpdate:modelValue":t[1]||(t[1]=e=>d.value=e),options:g.value,optionLabel:"name",placeholder:"Silah Pilih Kelas"},null,8,["modelValue","options"])])]),ne,a(k,{type:"button",icon:"pi pi-upload",label:"Generate",class:"p-button mb-2",onClick:t[2]||(t[2]=e=>b.value=!0)})]),n("div",oe,[a(E,{ref_key:"dt",ref:$,value:l.value,paginator:!0,class:"p-datatable-gridlines",rows:20,dataKey:"id",rowHover:!0,rowsPerPageOptions:[20,50,75,100],filters:y.value,"onUpdate:filters":t[6]||(t[6]=e=>y.value=e),filterDisplay:"menu",loading:U.value,responsiveLayout:"scroll",globalFilterFields:["name","NIS","NISN"]},{header:s(()=>[n("div",se,[n("div",ie,[a(k,{type:"button",icon:"pi pi-filter-slash",label:"Clear",class:"p-button-outlined mb-2",onClick:t[3]||(t[3]=e=>F())}),a(k,{type:"button",icon:"pi pi-upload",label:"Export",class:"p-button-outlined mb-2",onClick:t[4]||(t[4]=e=>j())})]),n("span",de,[re,a(v,{modelValue:y.value.global.value,"onUpdate:modelValue":t[5]||(t[5]=e=>y.value.global.value=e),placeholder:"Keyword Search",style:{width:"100%"}},null,8,["modelValue"])])])]),empty:s(()=>[p(" Data Tidak Ditemukan. ")]),loading:s(()=>[p(" Memuat Data Presensi, Mohon Tunggu. ")]),default:s(()=>[a(w,{field:"name",header:"Name",style:{"min-width":"12rem"}},{body:s(({data:e})=>[p(N(e.name),1)]),filter:s(({filterModel:e})=>[a(v,{type:"text",modelValue:e.value,"onUpdate:modelValue":u=>e.value=u,class:"p-column-filter",placeholder:"Search by name"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),a(w,{field:"NISN",header:"NISN",style:{"min-width":"12rem"}},{body:s(({data:e})=>[p(N(e.NISN),1)]),filter:s(({filterModel:e})=>[a(v,{type:"text",modelValue:e.value,"onUpdate:modelValue":u=>e.value=u,class:"p-column-filter",placeholder:"Search by NISN"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),a(w,{field:"gender",header:"Kelamin",style:{"min-width":"12rem"}},{body:s(({data:e})=>[p(N(e.code),1)]),filter:s(({filterModel:e})=>[a(v,{type:"text",modelValue:e.value,"onUpdate:modelValue":u=>e.value=u,class:"p-column-filter",placeholder:"Search by NISN"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),a(w,{field:"timestamp",header:"timestamp",style:{"min-width":"12rem"}},{body:s(({data:e})=>[p(N(e.timestamp),1)]),filter:s(({filterModel:e})=>[a(v,{type:"text",modelValue:e.value,"onUpdate:modelValue":u=>e.value=u,class:"p-column-filter",placeholder:"Search by NISN"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),a(w,{field:"is_late",header:"Status",style:{"min-width":"12rem"}},{body:s(({data:e})=>[e.is_late==!0?(I(),C("div",ue," Terlambat ")):(I(),C("div",ce," Tepat Waktu "))]),filter:s(({filterModel:e})=>[a(v,{type:"text",modelValue:e.value,"onUpdate:modelValue":u=>e.value=u,class:"p-column-filter",placeholder:"Search by NISN"},null,8,["modelValue","onUpdate:modelValue"])]),_:1})]),_:1},8,["value","filters","loading"])]),a(M,{visible:b.value,"onUpdate:visible":t[8]||(t[8]=e=>b.value=e),modal:"",header:"Generate",style:{width:"50rem"}},{default:s(()=>[pe,me,n("div",he,[a(k,{type:"button",label:"Cancel",severity:"secondary",onClick:t[7]||(t[7]=e=>b.value=!1)}),a(k,{type:"button",label:"Generate",loading:T.value,onClick:P},null,8,["loading"])])]),_:1},8,["visible"])],64)}}});export{Se as default};
